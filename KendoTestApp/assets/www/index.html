    <!DOCTYPE html>
    <!--
        Licensed to the Apache Software Foundation (ASF) under one
        or more contributor license agreements.  See the NOTICE file
        distributed with this work for additional information
        regarding copyright ownership.  The ASF licenses this file
        to you under the Apache License, Version 2.0 (the
        "License"); you may not use this file except in compliance
        with the License.  You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

        Unless required by applicable law or agreed to in writing,
        software distributed under the License is distributed on an
        "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
         KIND, either express or implied.  See the License for the
        specific language governing permissions and limitations
        under the License.
    -->
    <html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no;" />
        <meta charset="utf-8">
        <link rel="stylesheet" href="css/kendo.common.min.css" type="text/css" />   
        <link rel="stylesheet" href="css/kendo.default.min.css" type="text/css" />   
        <link rel="stylesheet" href="css/kendo.mobile.all.min.css" type="text/css" />   
        <style>
        [href*=index], #back-button
        {
            visibility: hidden;
        }
        </style>  

        <script type="text/javascript" src="cordova-2.6.0.js"></script>
        <script src="js/jquery.min.js"></script>
        <script src="js/jquery-ui-1.10.3.js"></script>
        <script src="js/kendo.all.min.js"></script>
        <script src="js/kendo.mobile.min.js"></script>

        <!-- cordova facebook plugin -->
        <script src="js/cdv-plugin-fb-connect.js"></script>

        <!-- facebook js sdk -->
        <script src="js/facebook-js-sdk.js"></script>
        <script type="text/javascript" src="js/ApplicationUser.js"></script>
        <script type="text/javascript" src="js/current.js"></script>
        <script type="text/javascript">


        function onBodyLoad()
        {   window.current = new Current(FB);
            window.current.subscribeForFBEvents();             
            document.addEventListener("deviceready", onDeviceReady, false);        
        }

        function onDeviceReady()
        {
            console.log("The device is ready");
            document.addEventListener("backbutton", onBackButtonPressed, false);
            window.current.initFb();
        }

        function onBackButtonPressed () {
            // sabrym : we can use the navigator object to go back in history else if we do not want to 
            // see fit that the application needs to be closed then can call   navigator.app.exitApp();
            navigator.app.backHistory();
        }

        </script>
        <title>Kendo Mobile Tryout - 99x</title>
    </head>
    <body onload="onBodyLoad()"> 

        <!-- Application Views -->
        <div data-role="view" id="loginView" class="km-insetcontent" data-title="Application Landing View" data-model="landingModel" data-init="viewInit" data-hide="viewHide">         
            <img src="img/connect.png" class="application-logo" /><br />
            <a data-role="button" id="modalview-open-button" data-bind="click: navigateToSelected" data-parameter="login">Login</a>
            <a data-role="button" id="modalview-help-button" data-bind="click: navigateToSelected" data-parameter="help">Help</a>
            <button id="show" data-role="button">Show Loading Popup</button>
        </div>       
        <div data-role="view" id="forms" data-title="Add Meetup View" data-model="addMeetupModel" data-init="initForm" data-use-native-scrolling="true"> 
            <form>
             <ul data-role="listview" data-style="inset">
                <li>
                    <label>
                        Meet Up Name
                        <input type="text" value="Text"  data-bind="value: meetupName" id="meetupName" data-change="changeListener"/>
                    </label>
                </li>
                <li>
                    <label>
                        Date
                        <input type="date"  data-bind="value: meetupDate" id="meetupDate"/>
                    </label>
                </li>
                <li>
                    <label>
                     <a data-role="button" id="addFriends" data-bind="click: addFriendsToMeetup">Add Friends to Meetup </a>
                 </label>
             </li>
             <li>
                Meetup Time
                <label>
                    <input type="time" data-bind="value: meetupTime" id="meetupTime"/>
                </label>
            </li>
             <li>
                Meetup Location
                <label>src:<select data-text-field="name" data-value-field="url" data-bind="source: locations, value: imageSrc" ></select></label>
            </li>
            <li>
                <label>
                 <a data-role="button" id="createMeetup" data-bind="click: createMeetup">Create Meetup</a>
             </label>
            </li>                                
        </ul>
        </form>
    </div>
 <div data-role="view" data-title="Destinations" id="listview-home">
    <ul data-role="listview" data-style="inset" data-type="group">
        <li>
            Africa
            <ul>
                <li data-icon="toprated"><a>Nairobi</a></li>
            </ul>
        </li>
        <li>
            America
            <ul>
                <li data-icon="globe"><a>Boston</a></li>
                <li data-icon="globe"><a>Ottawa</a></li>
                <li data-icon="toprated"><a>San Francisco</a></li>
            </ul>
        </li>
        <li>
            Asia
            <ul>
                <li data-icon="globe"><a>Bombay</a></li>
            </ul>
        </li>
        <li>
            Australia
            <ul>
                <li data-icon="globe"><a>Melbourne</a></li>
                <li data-icon="toprated"><a>Sydney</a></li>
            </ul>
        </li>
        <li>
            Europe
            <ul>
                <li data-icon="globe"><a>Cannes</a></li>
                <li data-icon="globe"><a>Liverpool</a></li>
                <li data-icon="toprated"><a>London</a></li>
            </ul>
        </li>
    </ul>
</div>

<div data-role="view" id="friendsView" data-layout="layout" data-title="Friends View" data-model="localViewModel" data-layout="layout">
    <div style="background: url(../../content/shared/images/patterns/pattern7.png); color: #fff; padding: 50px 0; text-align: center;">
        <ul id="flat-listview" data-role="listview" data-template="friendsTemplate" data-click="onClick"></ul>
    </div>
</div>

<!-- <div data-role="view" id="addFriendsToMeetupView" data-layout="layout" data-title="Friends View" data-model="friendsToMeetupViewModel" data-layout="layout">
    <div style="background: url(../../content/shared/images/patterns/pattern7.png); color: #fff; padding: 50px 0; text-align: center;">
        <ul id="flat-listview" data-role="listview" data-template="friendsTemplate"></ul>
    </div>
</div>
 -->
<div data-role="layout" data-id="layout" data-platform="android">
    <footer data-role="footer">
     <div>
        <a data-role="button" data-click="alertMe" data-icon="featured">Add a new Meetup</a>
    </div>
</footer>
</div>
<!-- Application Views End -->

<script id="friendsTemplate" type="text/x-kendo-template">
<div><img src= #=picture.data.url# alt="#: data.name #"/><p>#: name #</p> </div>
</script>

<!-- TODO: incorporate separate css file -->
<style scoped>
#forms input:not([type=checkbox]):not([type=radio]),
#forms select,
#forms .k-dropdown
{
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
    width: 50%;
}
#forms label {
    display: inline-block;
    width: 100%;
}
.km-ios #loading .km-content
{
    background: transparent;
}

#loading .km-content
{
    text-align: center;
}

#show
{
    margin-top: 100px;
    font-size: 1.2em;
}

/* Example Counter */
.km-meego h1.loaderHeading,
.km-android h1.loaderHeading,
.km-blackberry h1.loaderHeading
{
    display: block;
    position: absolute;
    overflow: hidden;
    width: 1em;
    left: 50%;
    height: 1em;
    top: 50%;
    font-size: 1.2rem;
    margin: -.65em 0 0 -.5em;
}

.km-android h1.loaderHeading
{
    margin: -.55em 0 0 -.5em;
}

.km-flat h1.loaderHeading,
.km-wp h1.loaderHeading
{
    display: block;
}

.km-ios h1.loaderHeading
{
    font-size: 1rem;
}
.km-meego h1.loaderHeading,
.km-blackberry h1.loaderHeading
{
    font-size: 1.5rem;
}


.buttonAppearance .km-button:not(.km-back)
{
    width: 90%;
    box-sizing: border-box;
    -moz-box-sizing: border-box;
    -webkit-box-sizing: border-box;
}
#layoutView .km-view-title
{
    visibility: inherit;
}

.km-android #layoutView .km-view-title
{
    display: block;
    position: static;
}
#modalview-login-button,
#modalview-reg-button,
#modalview-open-button {
    display: block;
    text-align: center;
    margin: .6em .8em;
    font-size: 1.2em;
}

#modalview-open-button {
    margin: 0 3em;
    padding: .5em;
}
.km-flat #modalview-open-button {
    color: #fff;
}

#loginView {
    text-align: center;
}

#loginView img {
    display: block;
    margin: 30px auto;
}

    /*#loginView .km-content,
    .km-ios #modalview-login .km-content {
        background: url(../../content/shared/images/patterns/pattern1.png) repeat 0 0;
        }*/

        #modalview-login label {
            display: inline-block;
            width: 100%;
        }
        .km-ios #loginView .km-button,
        .km-ios #modalview-login .km-button,
        .km-ios #loginView .km-navbar,
        .km-ios #modalview-login .km-header,
        .km-blackberry #loginView .km-navbar,
        .km-blackberry #modalview-login .km-navbar
        {
            background-color: #000;
        }

        .km-blackberry #loginView .km-button
        {
            color: #fff;
        }

        .km-ios #loginView .km-button:active,
        .km-ios #loginView .km-state-active,
        .km-ios #modalview-login .km-button:active,
        .km-ios #modalview-login .km-state-active {
            background-color: #2e2e2e;
        }

        .km-ios #modalview-login #modalview-login-button,
        .km-flat #modalview-login #modalview-login-button {
            background-color: Green;
            color: #fff;
        }

        .km-tablet .km-ios #loginView .km-view-title,
        .km-tablet .km-ios #modalview-login .km-view-title {
            color: #fff;
            text-shadow: 0 -1px rgba(0,0,0,.5);
        }

         #flat-listview .listview-selected {
            background-color: #FFFF00;
        }

        </style>
        <script>
        // TODO: incorporate in separate JS file
        function onClick(e) {
            var index = $(e.item).index();
            alert(e.item + "Index of item: " + index);
            //alert(window.current.retrievedFriends[index]);
            e.item.toggleClass("listview-selected");
        }
        
        <!-- These are the notifications that are displayed to the user through pop-ups if the above JS files does not exist in the same directory-->
        if ((typeof cordova == 'undefined') && (typeof Cordova == 'undefined')) alert('Cordova variable does not exist. Check that you have included cordova.js correctly');
        if (typeof CDV == 'undefined') alert('CDV variable does not exist. Check that you have included cdv-plugin-fb-connect.js correctly');
        if (typeof FB == 'undefined') alert('FB variable does not exist. Check that you have included the Facebook JS SDK file.');


        var addMeetupModel = kendo.observable({
           
            meetupTime: "22:30",
            meetupName: "My Pretty Meetup",
            loadFriends: function () {

            },
            createMeetup: function () {
                var tempMeetupModel = addMeetupModel;
                delete tempMeetupModel.food;

                var json = tempMeetupModel.toJSON();
                json.facebookId = window.current.applicationUser.userId;
                alert(JSON.stringify(json));
                // TODO: sabrym use ajax and save to server !
                // need to save the friends that have been added as well
                // TODO: use one request or two for this purpose??
            },
            imageSrc: null,
            locations: [
                { name: "Mishi Kobe Niku", url: "../../content/web/foods/9.jpg" },
                { name: "Chef Anton's Cajun Seasoning", url: "../../content/web/foods/4.jpg" },
                { name: "Queso Manchego La Pastora", url: "../../content/web/foods/12.jpg" },
            ]
        });
        addMeetupModel.imageSrc = addMeetupModel.locations[0].url;
        
        function initForm() {
            alert("Init form");
            //TODO: Any sort of initialization code if needed
        }

        var landingModel = kendo.observable({
            navigateToSelected: function (e) {
                var param = $(e.target).data('parameter');
                if (param === "login") 
                {           
                    alert("Log me in");               
                    window.current.loginUser(function(){ window.kendoMobileApplication.navigate("#friendsView");}, function() { animate() }, queryFriends);
                }
                else if (param === "help") 
                {
                    alert("Login Status : " + current.getLoginStatus());
                }

            }
        });

        function alertMe() {
        // body...
        alert("Meetup! => transition to the meetup view here");
    }

    function queryMeetups (userId) {
        // query the users meetups.. all being existing, 
    }
    function queryFriends(tokenUrl, addFriends) {
        hideLoader();
        $("#flat-listview").kendoMobileListView(
        { 
            dataSource: {
                transport: {
                  read: {
                    dataType: "jsonp",
                    url: tokenUrl
                }
            },
            schema: {
                data: "data",
            },
             change: function(e) {
                if (e.items !== undefined) 
                {
                    addFriends(e.items);
                }
              //e.items
              console.log("DataSource changed" + e.items[0].picture.data.url);
              console.log("Reason: `" + (e.action || "data bound") + "`");
            }
        },
        selectable: "single",
        template: $("#friendsTemplate").html()
    });
    }

    // loading stuff
    var showButton, interval, loaderElement;
    function viewInit(e) {
        showButton = $("#show").bind(kendo.support.mouseup, function() {
            currentDiv.animate({ opacity: 0 });
            startLoading();
        });

        loaderElement = kendoMobileApplication.pane.loader.element.find("h1");
    }

    function animate () {
        var currentDiv = $("#loginView");
        currentDiv.animate({ opacity: 0 });
        startLoading();
    }

    function hideLoader() {
        clearInterval(interval);
        kendoMobileApplication.hideLoading(); //hide loading popup
        loaderElement.removeClass("loaderHeading").text("Loading...");
    }

    function viewHide(e) {
     var currentDiv = $("#loginView");
     currentDiv.animate({ opacity: 1 });
     hideLoader();
 }

 function startLoading() {
    var currentDiv = $("#loginView");
    hideLoader();
    var seconds = 5;

    loaderElement.text(seconds + " seconds left!").addClass("loaderHeading");

        kendoMobileApplication.showLoading(); //show loading popup

        interval = setInterval(function() {
            loaderElement.text(--seconds + " seconds left!"); //update text of the loading popup

            if (seconds == 0) {
                currentDiv.animate({ opacity: 1 });
                hideLoader();
            }
        }, 1000);
    }

    function addFriendsToMeetup () {
        // body...
        window.kendoMobileApplication.navigate("#friendsView");
    }
    </script>


    <script>
    window.kendoMobileApplication = new kendo.mobile.Application(document.body, {
        transition: "slide",
        initial: "loginView"
    } );
    </script>
</body>
</html>
